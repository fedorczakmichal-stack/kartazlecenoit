<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edytowalna Karta Zlece≈Ñ OIT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="top-controls no-print">
        <button onclick="window.print()" class="control-button print">
            <i class="fas fa-print"></i> Drukuj
        </button>
        <button onclick="generatePDF()" class="control-button pdf">
            <i class="fas fa-file-pdf"></i> Eksportuj PDF
        </button>
        <button onclick="saveCard()" class="control-button save">
            <i class="fas fa-save"></i> Zapisz
        </button>
        <button onclick="loadCard()" class="control-button load">
            <i class="fas fa-folder-open"></i> Wczytaj
        </button>
        <button onclick="clearCard()" class="control-button clear">
            <i class="fas fa-trash"></i> Wyczy≈õƒá
        </button>
        <button id="darkModeToggle" class="control-button dark-mode">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <div class="container" id="card-container">
        <!-- Header Section -->
        <div class="header-section">
            <div class="hospital-header">
                <div class="hospital-logo">
                    <div class="logo-icon">üè•</div>
                    <div>
                        <div style="font-size: 13px; font-weight: 600;">Szpital Zakonu Bonifratr√≥w ≈õw. Jana Bo≈ºego w ≈Åodzi</div>
                        <div style="font-size: 10px; opacity: 0.9;">ul. Kosynier√≥w Gdy≈Ñskich 61, 93-357 ≈Å√≥d≈∫</div>
                    </div>
                </div>
                <div class="header-right-info">
                    <div class="field-group">
                        <span class="field-label">Data</span>
                        <input type="text" id="mainDateInput" class="field-value small" onchange="calculateIcuDay()"/>
                    </div>
                    <div class="field-group">
                        <span class="field-label">Doba w OIT</span>
                        <input type="number" min="0" id="icuDayInput" class="field-value small"/>
                    </div>
                </div>
            </div>
            <h1>Oddzia≈Ç Anestezjologii i Intensywnej Terapii - Karta Zlece≈Ñ Lekarskich</h1>
        </div>

        <!-- Patient Information -->
        <div class="patient-card">
            <div class="patient-grid">
                <div class="field-group" style="grid-column: span 2;">
                    <span class="field-label">Imiƒô i Nazwisko</span>
                    <input type="text" id="patientNameInput" class="field-value"/>
                </div>
                <div class="field-group">
                    <span class="field-label">PESEL</span>
                    <input type="text" id="peselInput" class="field-value"/>
                </div>
                <div class="field-group">
                    <span class="field-label">Nr Historii</span>
                    <input type="text" id="historyNumberInput" class="field-value"/>
                </div>
                <div class="field-group">
                    <span class="field-label">Data przyjƒôcia</span>
                    <input type="text" placeholder="DD.MM.RRRR" id="admissionDateInput" class="field-value" onchange="calculateIcuDay()"/>
                </div>
                <div class="field-group">
                    <span class="field-label">Waga (kg)</span>
                    <input type="number" id="patientWeight" class="field-value" oninput="handleWeightHeightChange()"/>
                </div>
                <div class="field-group">
                    <span class="field-label">Wzrost (cm)</span>
                    <input type="number" id="heightInput" class="field-value" oninput="handleWeightHeightChange()"/>
                </div>
                <div class="field-group">
                    <span class="field-label">BMI</span>
                    <input type="text" id="bmiOutput" class="field-value" readonly/>
                </div>
                <div class="field-group" style="grid-column: span 2;">
                    <span class="field-label">Rozpoznanie</span>
                    <input type="text" id="diagnosisInput" class="field-value"/>
                </div>
                <div class="field-group">
                    <span class="field-label">GFR (ml/min)</span>
                    <input type="number" id="gfrInput" class="field-value gfr-input" oninput="adjustAllDosesForGfr()"/>
                </div>
                 <div class="field-group">
                    <span class="field-label">Sala/≈Å√≥≈ºko</span>
                    <input type="text" id="roomInput" class="field-value"/>
                </div>
                <div class="field-group" style="grid-column: span 4;">
                    <span class="field-label">‚ö†Ô∏è ALERGIE / NIETOLERANCJE</span>
                    <input type="text" id="allergiesInput" class="field-value alert-field"/>
                </div>
            </div>
        </div>

        <!-- Continuous Medications -->
        <div class="section-header">LEKI CIƒÑG≈ÅE - POMPY INFUZYJNE</div>
        <table id="continuousDrugsTable">
            <thead>
                <tr>
                    <th style="width: 35%;">Lek / Stƒô≈ºenie</th>
                    <th style="width: 25%;">Dawka</th>
                    <th style="width: 15%;">Prƒôdko≈õƒá [ml/h]</th>
                    <th style="width: 25%;">Podpis pielƒôgniarki</th>
                    <th class="action-column no-print"></th>
                </tr>
            </thead>
            <tbody id="continuousDrugsTbody"></tbody>
        </table>
        <div class="button-container no-print">
            <button onclick="addContinuousDrug()" class="add-button"><i class="fas fa-plus-circle"></i> Dodaj lek ciƒÖg≈Çy</button>
        </div>

        <!-- Periodic Medications -->
        <div class="section-header green">LEKI OKRESOWE</div>
        <table id="periodicDrugsTable">
            <thead>
                <tr>
                    <th style="width: 30%;">Lek / Dawka</th>
                    <th style="width: 15%;">Droga / Czƒôsto≈õƒá</th>
                    <th style="width: 55%;">Podpis pielƒôgniarki</th>
                    <th class="action-column no-print"></th>
                </tr>
            </thead>
            <tbody id="periodicDrugsTbody"></tbody>
        </table>
        <div class="button-container no-print">
            <button onclick="addPeriodicDrug()" class="add-button green"><i class="fas fa-plus-circle"></i> Dodaj lek okresowy</button>
        </div>

        <!-- Fluid Therapy -->
        <div class="section-header cyan">P≈ÅYNOTERAPIA I ≈ªYWIENIE</div>
        <table id="fluidsTable">
             <thead>
                <tr>
                    <th style="width: 20%;">P≈Çyn</th>
                    <th style="width: 35%;">Dodatki</th>
                    <th style="width: 10%;">Objƒôto≈õƒá [ml]</th>
                    <th style="width: 10%;">Prƒôdko≈õƒá [ml/h]</th>
                    <th style="width: 25%;">Podpis pielƒôgniarki</th>
                    <th class="action-column no-print"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <table id="nutritionTable">
            <thead>
                <tr>
                    <th style="width: 30%;">Typ ≈ºywienia</th>
                    <th style="width: 45%;">Preparat / Dawka</th>
                    <th style="width: 25%;">Podpis pielƒôgniarki</th>
                    <th class="action-column no-print"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="controls-summary-container">
             <div class="button-container no-print">
                <button onclick="addFluid()" class="add-button cyan"><i class="fas fa-plus-circle"></i> Dodaj p≈Çyn</button>
                <button onclick="addNutrition()" class="add-button orange"><i class="fas fa-plus-circle"></i> Dodaj ≈ºywienie</button>
            </div>
            <div class="summary-container">
                <div id="fluidBalanceSummary">Suma p≈Çyn√≥w / 24h: <strong><span id="totalFluids">0</span> ml</strong></div>
                <div id="kcalSummary">Suma kcal / 24h: <strong><span id="totalKcal">0</span> kcal</strong></div>
            </div>
        </div>

        <!-- Procedures -->
        <div class="section-header purple">PROCEDURY / ZABIEGI</div>
        <table id="proceduresTable">
            <thead>
                <tr>
                    <th style="width: 15%;">Godzina</th>
                    <th style="width: 50%;">Procedura</th>
                    <th style="width: 35%;">Wykonano (podpis)</th>
                    <th class="action-column no-print"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="button-container no-print">
            <button onclick="addProcedure()" class="add-button purple"><i class="fas fa-plus-circle"></i> Dodaj procedurƒô</button>
        </div>

        <!-- Additional Notes -->
        <div class="section-header gray">UWAGI DODATKOWE / ZALECENIA</div>
        <div class="footer-grid">
            <div class="notes-section">
                <textarea placeholder="Miejsce na dodatkowe zalecenia, uwagi, konsultacje..."></textarea>
            </div>
            <div class="signature-box">
                <div class="signature-line"></div>
                <div class="signature-label">LEKARZ DY≈ªURNY</div>
                <div class="signature-sublabel">(pieczƒÖtka i podpis)</div>
            </div>
        </div>
    </div>

    <!-- Modals and Datalists -->
    <div id="additivesModal" class="modal no-print" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ZarzƒÖdzaj dodatkami</h3>
                <span class="close" onclick="closeModal('additivesModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="additives-list"></div>
                <button onclick="addAdditiveRowToModal()" class="add-button cyan small"><i class="fas fa-plus"></i> Dodaj kolejny</button>
            </div>
            <div class="modal-footer">
                <button onclick="saveAdditives()" class="control-button save">Zapisz</button>
            </div>
        </div>
    </div>
    <datalist id="continuousDrugsList"></datalist>
    <datalist id="periodicDrugsList"></datalist>
    <datalist id="fluidsList"></datalist>
    <datalist id="additivesList"></datalist>
    <datalist id="enteralProductsList"></datalist>
    <datalist id="parenteralProductsList"></datalist>
    <datalist id="nutritionTypesList"> <option value="≈ªywienie dojelitowe"><option value="≈ªywienie parenteralne"><option value="Dieta doustna"> </datalist>
    <datalist id="proceduresList"> <option value="Toaleta drzewa oskrzelowego"><option value="RTG klatki piersiowej przy≈Ç√≥≈ºkowe"><option value="Zmiana opatrunku CVC"><option value="Zmiana pozycji cia≈Ça"><option value="Profilaktyka odle≈ºyn"><option value="USG p≈Çuc"><option value="USG jamy brzusznej"><option value="Bronchoskopia"><option value="Wymiana rurki intubacyjnej"><option value="Wymiana rurki tracheostomijnej"><option value="Za≈Ço≈ºenie CVC"><option value="Za≈Ço≈ºenie cewnika tƒôtniczego"><option value="Za≈Ço≈ºenie cewnika Foleya"><option value="Punkcja lƒôd≈∫wiowa"><option value="Nak≈Çucie jamy op≈Çucnej"><option value="Drena≈º jamy op≈Çucnej"><option value="CRRT - rozpoczƒôcie"><option value="CRRT - wymiana zestawu"><option value="Hemodializa"><option value="Plazmafereza"><option value="Fizjoterapia"><option value="Rehabilitacja oddechowa"><option value="Pionizacja"><option value="EKG"><option value="ECHO serca"><option value="Gastroskopia"><option value="Kolonoskopia"><option value="CT g≈Çowy"><option value="CT klatki piersiowej"><option value="CT jamy brzusznej"> </datalist>
    <datalist id="timesList"> <option value="06:00"><option value="07:00"><option value="08:00"><option value="09:00"><option value="10:00"><option value="11:00"><option value="12:00"><option value="13:00"><option value="14:00"><option value="15:00"><option value="16:00"><option value="17:00"><option value="18:00"><option value="19:00"><option value="20:00"><option value="21:00"><option value="22:00"><option value="23:00"><option value="00:00"><option value="01:00"><option value="02:00"><option value="03:00"><option value="04:00"><option value="05:00"><option value="q1h"><option value="q2h"><option value="q4h"><option value="q6h"><option value="PRN"> </datalist>
    
    <script src="script.js"></script>
</body>
</html>
