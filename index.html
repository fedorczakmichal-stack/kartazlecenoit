<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edytowalna Karta Zlece≈Ñ OIT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container" id="card-container">
        <div class="top-controls no-print">
            <button onclick="window.print()" class="print-button">üñ®Ô∏è Drukuj kartƒô</button>
            <button onclick="generatePDF()" class="print-button pdf">üìÑ Eksportuj PDF</button>
            <button onclick="saveCard()" class="print-button" style="background: #4CAF50;">üíæ Zapisz kartƒô</button>
            <button onclick="loadCard()" class="print-button" style="background: #FF9800;">üìÇ Wczytaj kartƒô</button>
            <button onclick="clearCard()" class="print-button" style="background: #f44336;">üóëÔ∏è Wyczy≈õƒá kartƒô</button>
            <button id="darkModeToggle">üåô</button>
        </div>
        
        <div class="no-print" style="background: #e8f5e9; padding: 8px; border-radius: 4px; margin: 10px; font-size: 11px; text-align: center;">
            <span><strong>üí° Wskaz√≥wka:</strong> Kliknij `+ Dodaj` w sekcji p≈Çyn√≥w, aby otworzyƒá okno zarzƒÖdzania dodatkami.</span>
        </div>
        
        <div id="additivesModal" class="modal no-print" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ZarzƒÖdzaj dodatkami</h3>
                    <span class="close" onclick="closeModal('additivesModal')">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="additives-list"></div>
                    <button onclick="addAdditiveRowToModal()" class="add-button fluids">+ Dodaj kolejny</button>
                </div>
                <div class="modal-footer">
                    <button onclick="saveAdditives()" class="print-button" style="background: #4CAF50;">Zapisz</button>
                </div>
            </div>
        </div>

        <div class="header">
            <h1>KARTA ZLECE≈É LEKARSKICH - ODDZIA≈Å INTENSYWNEJ TERAPII</h1>
            <div class="main-header">
                <div class="header-item name">
                    <label>Imiƒô i Nazwisko</label>
                    <input type="text" placeholder="..." id="patientNameInput" class="header-input"/>
                </div>
                <div class="header-item pesel">
                    <label>PESEL</label>
                    <input type="text" placeholder="..." pattern="\d{11}" title="PESEL musi sk≈Çadaƒá siƒô z 11 cyfr" id="peselInput" class="header-input"/>
                </div>
                <div class="header-item history">
                    <label>Nr historii</label>
                    <input type="text" placeholder="..." id="historyNumberInput" class="header-input"/>
                </div>
                <div class="header-item diagnosis">
                    <label>Rozpoznanie</label>
                    <input type="text" placeholder="..." id="diagnosisInput" class="header-input"/>
                </div>
                <div class="header-item allergy">
                    <label>Alergie</label>
                    <input type="text" placeholder="..." id="allergiesInput" class="header-input"/>
                </div>
            </div>
            <div class="patient-context-bar">
                <div class="header-item admission-date">
                    <label>Data przyjƒôcia</label>
                    <input type="text" placeholder="DD.MM.RRRR" id="admissionDateInput" class="header-input" onchange="calculateIcuDay()"/>
                </div>
                 <div class="header-item room">
                    <label>Sala/≈Å√≥≈ºko</label>
                    <input type="text" placeholder="..." id="roomInput" class="header-input"/>
                </div>
                <div class="header-item weight">
                    <label>Waga (kg)</label>
                    <input type="number" min="0" placeholder="..." id="patientWeight" oninput="handleWeightHeightChange()" class="header-input"/>
                </div>
                <div class="header-item height">
                    <label>Wzrost (cm)</label>
                    <input type="number" min="0" placeholder="..." id="heightInput" oninput="handleWeightHeightChange()" class="header-input"/>
                </div>
                 <div class="header-item bmi">
                    <label>BMI</label>
                    <input type="text" id="bmiOutput" class="header-input" readonly />
                </div>
                <div class="header-item date">
                    <label>Data</label>
                    <input type="text" id="mainDateInput" class="header-input" onchange="calculateIcuDay()"/>
                </div>
                <div class="header-item icu-day">
                    <label>Doba w OIT</label>
                    <input type="number" min="0" placeholder="0" id="icuDayInput" class="header-input"/>
                </div>
            </div>
        </div>

        <h2 class="drugs-continuous">LEKI CIƒÑG≈ÅE - POMPY INFUZYJNE</h2>
        <table id="continuousDrugsTable">
            <thead>
                <tr>
                    <th width="30%">Lek / Stƒô≈ºenie</th>
                    <th width="20%">Dawka</th>
                    <th width="15%">Prƒôdko≈õƒá [ml/h]</th>
                    <th width="25%">Podpis pielƒôgniarki</th>
                    <th width="10%" class="action-column no-print">Akcje</th>
                </tr>
            </thead>
            <tbody id="continuousDrugsTbody">
            </tbody>
        </table>
        <div class="button-container no-print">
            <button onclick="addContinuousDrug()" class="add-button continuous">+ Dodaj lek ciƒÖg≈Çy</button>
        </div>
        <h2 class="drugs-periodic">LEKI OKRESOWE</h2>
        <table id="periodicDrugsTable">
            <thead>
                <tr>
                    <th width="25%">Lek / Dawka</th>
                    <th width="15%">Droga / Czƒôsto≈õƒá</th>
                    <th width="50%">Podpis pielƒôgniarki</th>
                    <th width="10%" class="action-column no-print">Akcje</th>
                </tr>
            </thead>
            <tbody id="periodicDrugsTbody"></tbody>
        </table>
        <div class="button-container no-print">
            <button onclick="addPeriodicDrug()" class="add-button periodic">+ Dodaj lek okresowy</button>
             <button onclick="addSeparator()" class="add-button separator">+ Dodaj separator</button>
        </div>
        <h2 class="fluids">P≈ÅYNOTERAPIA</h2>
        <table id="fluidsTable">
            <thead>
                <tr>
                    <th width="25%">P≈Çyn</th>
                    <th width="30%">Dodatki</th>
                    <th width="10%">Objƒôto≈õƒá [ml]</th>
                    <th width="10%">Prƒôdko≈õƒá [ml/h]</th>
                    <th width="15%">Podpis pielƒôgniarki</th>
                    <th width="10%" class="action-column no-print">Akcje</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <h2 class="nutrition">≈ªYWIENIE</h2>
        <table id="nutritionTable">
            <thead>
                <tr>
                    <th width="30%">Typ</th>
                    <th width="40%">Preparat / Dawka</th>
                    <th width="20%">Podpis pielƒôgniarki</th>
                    <th width="10%" class="action-column no-print">Akcje</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="controls-summary-container no-print">
            <div class="button-container">
                <button onclick="addFluid()" class="add-button fluids">+ Dodaj p≈Çyn</button>
                <button onclick="addNutrition()" class="add-button nutrition">+ Dodaj ≈ºywienie</button>
            </div>
            <div class="summary-container">
                <div id="fluidBalanceSummary"><strong>Suma p≈Çyn√≥w / 24h:</strong> <span id="totalFluids">0</span> ml</div>
                <div id="kcalSummary"><strong>Suma kcal / 24h:</strong> <span id="totalKcal">0</span> kcal</div>
            </div>
        </div>

        <h2 class="procedures">PROCEDURY / ZABIEGI</h2>
        <table id="proceduresTable">
            <thead>
                <tr>
                    <th width="15%">Godzina</th>
                    <th width="40%">Procedura</th>
                    <th width="35%">Wykonano (podpis)</th>
                    <th width="10%" class="action-column no-print">Akcje</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="button-container no-print">
            <button onclick="addProcedure()" class="add-button procedures">+ Dodaj procedurƒô</button>
        </div>
        <div class="footer">
            <h2 class="notes">UWAGI DODATKOWE</h2>
            <div style="display: flex; gap: 20px; align-items: flex-start;">
                <div style="flex: 2; border: 1px solid var(--border-color); padding: 5px; min-height: 80px; background: linear-gradient(to bottom, var(--table-row-even-bg), var(--header-gradient-start)); border-radius: 3px;">
                    <textarea style="width: 100%; min-height: 75px; border: none; background: transparent; font-family: Arial, sans-serif; font-size: 12px; color: var(--text-color); resize: vertical;" placeholder="Miejsce na dodatkowe zalecenia, uwagi, konsultacje..."></textarea>
                </div>
                <div style="flex: 1; text-align: center; padding: 10px;">
                    <strong style="font-size: 13px; color: #2c5aa0;">LEKARZ DY≈ªURNY:</strong>
                    <div class="signature-box" style="margin: 15px 0; min-height: 50px;"></div>
                    <div style="font-size: 10px; color: #666;">(pieczƒÖtka i podpis)</div>
                </div>
            </div>
        </div>
    </div>
    
    <datalist id="continuousDrugsList"></datalist>
    <datalist id="periodicDrugsList"></datalist>
    <datalist id="fluidsList"></datalist>
    <datalist id="additivesList"></datalist>
    <datalist id="enteralProductsList"></datalist>
    <datalist id="parenteralProductsList"></datalist>
    
    <datalist id="nutritionTypesList"> <option value="≈ªywienie dojelitowe"><option value="≈ªywienie parenteralne"><option value="Dieta doustna"> </datalist>
    <datalist id="proceduresList"> <option value="Toaleta drzewa oskrzelowego"><option value="RTG klatki piersiowej przy≈Ç√≥≈ºkowe"><option value="Zmiana opatrunku CVC"><option value="Zmiana pozycji cia≈Ça"><option value="Profilaktyka odle≈ºyn"><option value="USG p≈Çuc"><option value="USG jamy brzusznej"><option value="Bronchoskopia"><option value="Wymiana rurki intubacyjnej"><option value="Wymiana rurki tracheostomijnej"><option value="Za≈Ço≈ºenie CVC"><option value="Za≈Ço≈ºenie cewnika tƒôtniczego"><option value="Za≈Ço≈ºenie cewnika Foleya"><option value="Punkcja lƒôd≈∫wiowa"><option value="Nak≈Çucie jamy op≈Çucnej"><option value="Drena≈º jamy op≈Çucnej"><option value="CRRT - rozpoczƒôcie"><option value="CRRT - wymiana zestawu"><option value="Hemodializa"><option value="Plazmafereza"><option value="Fizjoterapia"><option value="Rehabilitacja oddechowa"><option value="Pionizacja"><option value="EKG"><option value="ECHO serca"><option value="Gastroskopia"><option value="Kolonoskopia"><option value="CT g≈Çowy"><option value="CT klatki piersiowej"><option value="CT jamy brzusznej"> </datalist>
    <datalist id="timesList"> <option value="06:00"><option value="07:00"><option value="08:00"><option value="09:00"><option value="10:00"><option value="11:00"><option value="12:00"><option value="13:00"><option value="14:00"><option value="15:00"><option value="16:00"><option value="17:00"><option value="18:00"><option value="19:00"><option value="20:00"><option value="21:00"><option value="22:00"><option value="23:00"><option value="00:00"><option value="01:00"><option value="02:00"><option value="03:00"><option value="04:00"><option value="05:00"><option value="q1h"><option value="q2h"><option value="q4h"><option value="q6h"><option value="PRN"> </datalist>
    
    <script src="script.js"></script>
</body>
</html>
