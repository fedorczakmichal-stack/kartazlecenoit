<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karta Zleceń OIT - Ulepszona v3.6</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="script.js" defer></script>
</head>
<body>
    <div id="toastContainer"></div>
    <div class="top-controls">
        <button class="control-button print" onclick="window.print()"><i class="fas fa-print"></i> Drukuj</button>
        <button class="control-button pdf" onclick="generatePDF()"><i class="fas fa-file-pdf"></i> PDF</button>
        <button class="control-button save" onclick="saveCard()"><i class="fas fa-save"></i> Zapisz</button>
        <button class="control-button load" onclick="loadCardFromBrowser()"><i class="fas fa-folder-open"></i> Wczytaj</button>
        <button class="control-button templates" onclick="openTemplateModal()"><i class="fas fa-list"></i> Szablony</button>
        <button class="control-button clear" onclick="clearCard()"><i class="fas fa-trash"></i> Wyczyść</button>
        <div class="autosave-indicator" id="autosaveIndicator"><i class="fas fa-check-circle"></i> Zapisano</div>
        <div class="offline-indicator" id="offlineIndicator" style="display: none;">Tryb offline</div>
        <button class="control-button dark-mode" id="darkModeToggle" onclick="toggleDarkMode()"><i class="fas fa-moon"></i> Tryb ciemny</button>
    </div>

    <div class="container" id="card-container">
        <div class="header-section">
            <div class="hospital-header">
                <div class="hospital-logo">
                    <i class="fas fa-hospital logo-icon">🏥</i>
                    <div>
                        <div>Szpital Zakonu Bonifratrów św. Jana Bożego w Łodzi</div>
                        <div>ul. Kosynierów Gdyńskich 61, 93-357 Łódź</div>
                    </div>
                </div>
                <div class="header-right-info">
                    <div class="field-group">
                        <label class="field-label">Data</label>
                        <input type="date" class="field-value header-input" id="mainDateInput" oninput="markAsChanged()">
                    </div>
                    <div class="field-group">
                        <label class="field-label">Doba w OIT</label>
                        <input type="text" class="field-value header-input" id="icuDayInput" readonly>
                    </div>
                    <div class="field-group">
                        <label class="field-label">Sala/Łóżko</label>
                        <input type="text" class="field-value header-input" id="roomInput" oninput="markAsChanged()">
                    </div>
                </div>
            </div>
            <h1>Oddział Anestezjologii i Intensywnej Terapii - Karta Zleceń Lekarskich</h1>
        </div>

        <div class="patient-card">
            <div class="patient-grid">
                <div class="field-group">
                    <label class="field-label">Imię i Nazwisko</label>
                    <input type="text" class="field-value header-input" id="patientNameInput" oninput="markAsChanged()">
                </div>
                <div class="field-group">
                    <label class="field-label">PESEL</label>
                    <input type="text" class="field-value header-input" id="peselInput" oninput="markAsChanged()">
                </div>
                <div class="field-group">
                    <label class="field-label">Nr Historii</label>
                    <input type="text" class="field-value header-input" id="historyNumberInput" oninput="markAsChanged()">
                </div>
                <div class="field-group">
                    <label class="field-label">Data przyjęcia</label>
                    <input type="date" class="field-value header-input" id="admissionDateInput" oninput="markAsChanged()">
                </div>
                <div class="field-group">
                    <label class="field-label">Waga (kg)</label>
                    <input type="number" class="field-value header-input" id="patientWeight" min="0" step="0.1" oninput="markAsChanged()">
                </div>
                <div class="field-group">
                    <label class="field-label">Wzrost (cm)</label>
                    <input type="number" class="field-value header-input" id="heightInput" min="0" oninput="markAsChanged()">
                </div>
                <div class="field-group">
                    <label class="field-label">BMI</label>
                    <input type="text" class="field-value header-input" id="bmiInput" readonly>
                </div>
                <div class="field-group">
                    <label class="field-label">Rozpoznanie</label>
                    <input type="text" class="field-value header-input input-with-gemini" id="diagnosisInput" list="diagnosisList" oninput="markAsChanged()">
                    <button class="gemini-icon-button" onclick="suggestDiagnosis()"><i class="fas fa-brain"></i></button>
                </div>
                <div class="field-group">
                    <label class="field-label">GFR (ml/min)</label>
                    <input type="number" class="field-value header-input" id="gfrInput" min="0" oninput="markAsChanged()">
                </div>
                <div class="field-group">
                    <label class="field-label">Sala/Łóżko (druk)</label>
                    <input type="text" class="field-value header-input print-only-room" id="roomInputPrint" oninput="markAsChanged()">
                </div>
                <div class="field-group">
                    <label class="field-label">Alergie / Nietolerancje</label>
                    <textarea class="field-value header-input alert-field" id="allergiesInput" rows="2" oninput="markAsChanged()"></textarea>
                </div>
            </div>
        </div>

        <div class="template-selection">
            <label for="templateSelect">Wybierz szablon:</label>
            <select id="templateSelect">
                <option value="Uniwersalny OIT">Uniwersalny OIT</option>
                <option value="Sepsa">Sepsa</option>
                <option value="Kardiochirurgia">Kardiochirurgia</option>
                <option value="Uraz wielonarządowy">Uraz wielonarządowy</option>
                <option value="Niewydolność oddechowa">Niewydolność oddechowa</option>
                <option value="Neurologia">Neurologia</option>
                <option value="CRRT">CRRT</option>
            </select>
            <button onclick="populateCardFromTemplate(document.getElementById('templateSelect').value)">Wczytaj szablon</button>
        </div>

        <div class="section-header">
            <i class="fas fa-syringe"></i> LEKI CIĄGŁE - POMPY INFUZYJNE
            <button class="add-button" onclick="addContinuousDrug()">+ Dodaj lek ciągły</button>
        </div>
        <table id="continuousDrugsTable">
            <thead>
                <tr>
                    <th>Lek / Stężenie</th>
                    <th>Dawka</th>
                    <th>Prędkość [ml/h]</th>
                    <th>Podpis pielęgniarki</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="continuousDrugsTbody"></tbody>
        </table>
        <datalist id="continuousDrugList"></datalist>

        <div class="section-header green">
            <i class="fas fa-pills"></i> LEKI OKRESOWE
            <button class="add-button" onclick="addPeriodicDrug()">+ Dodaj lek okresowy</button>
        </div>
        <table id="periodicDrugsTable">
            <thead>
                <tr>
                    <th>Lek / Dawka</th>
                    <th>Droga</th>
                    <th>Częstość</th>
                    <th>Podpis pielęgniarki</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="periodicDrugsTbody"></tbody>
        </table>
        <datalist id="periodicDrugList"></datalist>

        <div class="section-header orange">
            <i class="fas fa-tint"></i> PŁYNOTERAPIA I ŻYWIENIE
            <button class="add-button" onclick="addFluid()">+ Dodaj płyn</button>
            <button class="add-button" onclick="addNutrition()">+ Dodaj żywienie</button>
        </div>
        <table id="fluidsTable">
            <thead>
                <tr>
                    <th>Płyn</th>
                    <th>Dodatki</th>
                    <th>Objętość [ml]</th>
                    <th>Prędkość [ml/h]</th>
                    <th>Podpis pielęgniarki</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="fluidsTbody"></tbody>
        </table>
        <table id="nutritionTable">
            <thead>
                <tr>
                    <th>Typ żywienia</th>
                    <th>Preparat / Dodatki</th>
                    <th>Prędkość [ml/h]</th>
                    <th>Podpis pielęgniarki</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="nutritionTbody"></tbody>
        </table>

        <div class="section-header">
            <i class="fas fa-procedures"></i> ZABIEGI
            <button class="add-button" onclick="addProcedure()">+ Dodaj zabieg</button>
        </div>
        <table id="proceduresTable">
            <thead>
                <tr>
                    <th>Godzina</th>
                    <th>Zabieg</th>
                    <th>Podpis pielęgniarki</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="proceduresTbody"></tbody>
        </table>

        <div class="summary-container">
            <div>Suma płynów: <span id="fluidSum">0 ml</span></div>
            <div>Kalorie: <span id="kcalSum">0 kcal</span></div>
        </div>

        <div class="notes-section">
            <label for="notes">Uwagi lekarza:</label>
            <textarea id="notes" placeholder="Wpisz uwagi..." oninput="markAsChanged()"></textarea>
        </div>

        <div class="notes-section">
            <label for="doctorNotes">Uwagi dodatkowe:</label>
            <textarea id="doctorNotes" placeholder="Wpisz dodatkowe uwagi..." oninput="markAsChanged()"></textarea>
        </div>
    </div>

    <div id="templateModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTemplateModal()">&times;</span>
            <h2>Zarządzaj szablonami</h2>
            <div class="template-list" id="templateList"></div>
        </div>
    </div>

    <script>
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const toggleButton = document.getElementById('darkModeToggle');
            toggleButton.innerHTML = document.body.classList.contains('dark-mode')
                ? '<i class="fas fa-sun"></i> Tryb jasny'
                : '<i class="fas fa-moon"></i> Tryb ciemny';
        }

        function openTemplateModal() {
            const modal = document.getElementById('templateModal');
            modal.style.display = 'block';
            const templateList = document.getElementById('templateList');
            templateList.innerHTML = '';
            Object.keys(cardTemplates).forEach(template => {
                const div = document.createElement('div');
                div.className = 'template-item';
                div.innerHTML = `
                    <span>${template}</span>
                    <div>
                        <button onclick="populateCardFromTemplate('${template}')">Wczytaj</button>
                    </div>
                `;
                templateList.appendChild(div);
            });
        }

        function closeTemplateModal() {
            document.getElementById('templateModal').style.display = 'none';
        }

        function suggestDiagnosis() {
            showToast('Sugestia diagnozy', 'Funkcja niedostępna w tej wersji', 'warning', 3000);
        }
    </script>
</body>
</html>
